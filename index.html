<html>
	<head>
		<link rel="stylesheet" href="./css/SolitaireEngine.css"/>
		<script language="javascript" src="./js/jquery.min.js"></script>
		<script language="javascript" src="./js/underscore-min.js">
		</script>
		<script language="javascript" src="./js/SolitaireEngine.js"></script>

		<style>
			html, body {
				margin : 0px;
			}

			.awesome:hover {
				background: #1E90FF;
			}
			.awesome {
				font-family: monospace;
				background: #2BA9E3;
				display: inline-block;
				padding: 5px 10px 6px;
				color: #fff;
				text-decoration: none;
				font-weight: bold;
				line-height: 1;
				-moz-border-radius: 4px;
				-webkit-border-radius: 4px;
				-moz-box-shadow: 0 1px 3px #999;
				-webkit-box-shadow: 0 1px 3px #999;
				text-shadow: 0 -1px 1px #2BA9E3;
				border-bottom: 1px solid #2BA9E3;
				position: relative;
				cursor: pointer;
			}

		</style>
	</head>
	<body>

		<div id="map" style="background : url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAsSURBVDhPY+jFCxrwglHNGACqCgcYkZqhNA4ANQMHGNWMAaCqcICRp7m3FwCmtnaXHj1bYwAAAABJRU5ErkJggg==') center center; width : 100%; height : 100%;"></div>

		<script type="text/javascript">
			
			/*
			var gameConfig = {
    
			    "autoTips"     : "allToAll",// DEBUG
			    
			    "field"        : "#map",
			    "theme"        : "alternative_theme",
			    "debugLabels"  : true,
			    
			    "moveDistance" : 30,
			    "showTipsDestination" : true,
			    "showTipPriority"     : true,
			    
			    "winCheck" : {
			        // "callback" : function() {},
			        
			        "rules"     : {// "string" OR function(){} OR {object}
			            "lego" : [{
			                "filters" : [
			                    {"group" : ["twindeck", "group_b"]}
			                    // "allInOne"
			                ],
			                "rules"   : ["allEmpty"]
			            }]
			        }
			    },
			    "homeGroups" : ["group_a"],
			    "groups"       : {
			    // twindeck------------------------------
			        "twindeck"  : {
			            "position"    : {
			                "x" : 100,
			                "y" : 100
			            },
			            "placement"   : {
			                "x" : 20
			            },
			            "decks" : [
			                {
			                    "name"        : "td_from_deck",
			                    "showSlot"    : true,
			                    "paddingType" : "twindeck_typeA",
			                    "flip"        : "all",
			                    "takeRules"   : ["not"],
			                    "putRules"    : ["not"],
			                    "fill"        : ["c1", "c2", "c3", "c4", "c5", "c6", "c7"],
			                    "actions"     : {
			                        "twindeck" : {
			                            "to"         : "td_to_deck"//,
			                            // "count"      : 3,
			                            // "iterations" : 3,
			                        }
			                    }
			                },
			                {
			                    "name"        : "td_to_deck",
			                    // "paddingType" : "horizontal",
			                    "paddingX"    : 20,
			                    "paddingY"    : 1,
			                    "takeRules"   : ["onlytop"],
			                    "putRules"    : ["not"]
			                }
			            ]
			        },
			        // --------------------------------------
			        "group_a" : {
			            "position"  : {
			                "x" : 373,
			                "y" : 100
			            },
			            "placement" : {
			                "x" : 20
			            },
			            "showSlot"  : true,
			            "putRules"  : [
			                "ascendOne", 
			                "oneRank", 
			                "firstAce", 
			                "ascendDeck", 
			                "oneRankDeck"
			            ],
			            "fillRule"  : "deckLength",
			            "decks"     : 4
			        },
			        "group_b" : {
			            "position" : {
			                "x" : 100,
			                "y" : 300
			            },
			            "flip" : "notlast",
			            "placement"   : {
			                "x" : 20
			            },
			            "paddingType" : "vertical",
			            "showSlot"    : true,
			            "takeRules"   : "any",
			            "putRules"    : ["descentOne", "striped"],
			            "decks"       : 7
			        }
			    }
			};
			*/

			
			var gameConfig = {
			    // "scriptpath"   : "./js/",
			    "field"        : "#map",
			    "theme"        : "alternative_theme",
			    // "autoTips"     : "allToAll",
			    "tipsParams"   : {
			    	"hideOnEmpty" : true
			    },
			    "moveDistance" : 10,
			    "winCheck" : {
			        // "callback" : function() {},
			        "rules"     : {// "string" OR function(){} OR {object}
			            "lego" : [
			                {
			                    "filters" : [
			                        {"group" : "group_b1"}
			                    ],
			                    "rules"   : ["allDescent"]
			                },
			                {
			                    "filters" : [
			                        {"group" : "group_b2"}
			                    ],
			                    "rules"   : ["allAscend"]
			                },
			                {
			                    "filters" : [
			                        {"group" : "group_a"}
			                    ],
			                    "rules"   : ["allEmpty"]
			                }
			            ]
			        }
			    },
			    "groups"       : {
			        
			        "group_a" : {
			            "putRules"    : ["ascdescOne", "oneRank"],// "notForEmpty"],
			            "showSlot"    : true,
			            "paddingType" : "radial"
			        },
			        
			        "group_b1" : {
			            "position"    : {
			                "x" : 280, 
			                "y" : 250
			            },
			            "placement"   : {
			                "x" : 20
			            },
			            "takeRules" : ["notFirst"],
			            "putRules"  : ["descentOne", "oneRank"],
			            // "putRules"  : "descentOne",
			            "showSlot"  : true,
			            "decks"     : [
			                {
			                    "name" : "b1_c",
			                    "fill" : ['ck']
			                },
			                {
			                    "name" : "b1_h",
			                    "fill" : ['hk']
			                },
			                {
			                    "name" : "b1_d",
			                    "fill" : ['dk']
			                },
			                {
			                    "name" : "b1_s",
			                    "fill" : ['sk']
			                },
			                {
			                    "name"      : "hint_1",
			                    "showSlot"  : false,
			                    "putRules"  : ["not"],
			                    "takeRules" : ["not"],
			                    "class"     : "hintDown",
			                    "label"     : "ВНИЗ"
			                }
			            ]
			        },
			        
			        "group_b2" : {
			            "position"    : {
			                "x" : 280, 
			                "y" : 250 + 20 + 96
			            },
			            "placement"   : {
			                "x" : 20
			            },
			            "takeRules"   : ["notFirst"],
			            "putRules"    : ["ascendOne", "oneRank"],
			            "fillRule"    : "deckLength",
			            // "putRules"    : "ascendOne",
			            "showSlot"    : true,
			            "decks"       : [
			                {
			                    "name" : "b2_c",
			                    "fill" : ['c1']
			                },
			                {
			                    "name" : "b2_h",
			                    "fill" : ['h1']
			                },
			                {
			                    "name" : "b2_d",
			                    "fill" : ['d1']
			                },
			                {
			                    "name" : "b2_s",
			                    "fill" : ['s1']
			                },
			                {
			                    "name"      : "hint_1",
			                    "showSlot"  : false,
			                    "putRules"  : ["not"],
			                    "takeRules" : ["not"],
			                    "class"     : "hintUp",
			                    "label"     : "ВВЕРХ"
			                }
			            ]
			        },

			        
			    },
			    "homeGroups" : ["group_b1", "group_b2"]
			};
			

			gameConfig.groups['group_a'].decks = [];
            
            // SolitaireEngine.ready(function(SE) {
            //              b
            //       C  ..`:   A = sin(b) * C
            //     ...``   :B  B = cos(b) * C
            // a.``.......+:
            //        A     y 90deg
            var _step = 180 / 16;
            var _radius = 405;
            var _center = {
                x : 450 + 15,
                y : 450 + 20
            };
            var _card = SolitaireEngine._main.options.card;
            var _angle = _step / 2 + 270;
            var _deg = Math.PI / 180;
            for(var i = 0; i < 16; i += 1) {
                var _a = Math.sin(_angle * _deg) * _radius;
                var _b = Math.cos(_angle * _deg) * _radius;
                if(_angle > 360) _angle -= 360;
                // console.log("lunaDeck_" + i, _angle);
                gameConfig.groups['group_a'].decks.push({
                    "name" : "lunaDeck_" + i,
                    "rotate" : _angle,
                    "position" : {
                        "x" : _center.x + _a - _card.width / 2,
                        "y" : _center.y - _b - _card.height / 2
                    }
                });
                _angle += _step;
            }

			SolitaireEngine.event.listen('win', function(e) {

			    console.log('win');

			    // SolitaireEngine.event.dispatch('lock');
			});

			// c1|h9,d6|d10,s5,d3|s1,s4,hj,cq|dq,s7,c6,c4,sq|hk,d2,h1,s8,s6,d8|d1,h6,h10,h3,c10,d7,h4|dj,c8,ck,c3,h2,sj,c5,h5,dk,s2,d9,hq,c2,h7,s10,sk,c9,d5,cj,d4,h8,c7,s9,s3
		    /*var randomDeckForKosynkaSolitaire = SolitaireEngine._main.deckGenerator({
		        // type      : 'one_rank_only',
		        // cardsRank : '1 2 3 4 5 6 7 8 9 10'.split(' '),
		        shuffle   : true,
		    });
		    var a = [];
		    for(var i = 0; i < 7; i += 1) {
		        a[i] = [];
		        for(var j = 0; j <= i; j += 1) {
		            a[i].push(randomDeckForKosynkaSolitaire.pop());
		        }
		    }

		    gameConfig.groups.group_b.fill = a;
		    gameConfig.groups.twindeck.decks[0].fill = randomDeckForKosynkaSolitaire;*/
		    
		    // gameConfig.groups.group_b.fill = [["d3", "d2", "d1"], ["hk", "hq", "hj", "h10", "h9", "h8", "h7", "h6", "h5", "h4", "h3", "h2", "h1"]];
		    // gameConfig.groups.twindeck.decks[0].fill = ["d4"];

		    var gameStructure = "h5,s9,c5,d4,h8,d2|c1,c7,c9,d7,dj,dq|s2,c3,s9,c10,s8,sj|c2,dj,cq,s5,h4,s7|hq,s10,h9,s6,c8,c6|d3,c9,h6,cq,h3,h2|dk,ck,s4,dq,cj,d9|sq,s8,c2,hj,hq,sq|sk,d1,h2,d8,s7,s10|sj,c7,s4,s3,d10,h10|c5,hj,s6,cj,h4,d3|d4,h8,h7,d7,c3,d9|d2,s3,h10,c6,d6,h6|c4,d5,d6,c10,h7,h9|h1,s1,hk,h3,c8,h5|d10,d5,c4,s5,s2,d8";

		    var _decks = gameStructure.split('|');
            var _cards = [];
            for(var _i in _decks) {
                _cards.push(_decks[_i].split(','));
            }
            gameConfig.groups['group_a'].fill = _cards;
            
            gameConfig.showTips = true;
		    
			SolitaireEngine.init(gameConfig);
		</script>
		
	</body>
</html>
